# 砖 1: 砖  (Base image)
FROM python:3.11 as builder

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV APP_HOME /usr/src/app
WORKDIR $APP_HOME

# 转拽转 转转
COPY requirements.txt .
RUN pip install --upgrade pip
RUN pip install -r requirements.txt --no-cache-dir

# 砖 2: 砖 住驻 (Runtime image)
FROM python:3.11

ENV PYTHONUNBUFFERED 1
ENV APP_HOME /app
WORKDIR $APP_HOME

# 注转拽转 拽爪  住驻专转 site-packages ( 砖-uvicorn  )
COPY --from=builder /usr/local/bin /usr/local/bin
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages

# 注转拽转 拽 砖 ( 砖 拽爪 注专 砖专砖 拽专)
COPY . .

EXPOSE 8080

#  转拽 拽专: 专转 CMD 注 PORT 专专转 
# 转专 CMD  驻砖 转 砖转 住 PORT   爪 (拽专 转专), 砖转砖 -8080.
#   砖驻拽 驻专砖转 -Bash 转 拽专.
CMD ["/bin/bash", "-c", "uvicorn main:app --host 0.0.0.0 --port ${PORT}"]
