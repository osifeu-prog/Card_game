# 砖 1: 砖  (Base image)
FROM python:3.11 as builder

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV APP_HOME /usr/src/app # 转 注 
WORKDIR $APP_HOME

# 转拽转 转转
COPY requirements.txt .
RUN pip install --upgrade pip
RUN pip install -r requirements.txt --no-cache-dir

# --- 砖 2: 砖 住驻 (Runtime image) ---
FROM python:3.11

ENV PYTHONUNBUFFERED 1
ENV APP_HOME /app # 转 专爪
WORKDIR $APP_HOME

#  转拽: 注转拽转 拽爪  住驻专转 site-packages
#  注转拽 注砖 转  住驻专转 专砖转 转 -builder
# 专 转 -PATH 爪专 .
COPY --from=builder /usr/local/bin /usr/local/bin
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages

# 注转拽转 拽 砖 ( 砖 拽爪 注专 砖专砖 拽专)
COPY . .

EXPOSE 8080

# 驻注转 Uvicorn (驻拽  专住转 注  railway.toml startCommand)
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "${PORT:-8080}"]
