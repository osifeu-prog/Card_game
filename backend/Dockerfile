# 砖 1: 砖  (Base image)
FROM python:3.11-slim as builder

# 专转 砖转 住 
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV APP_HOME /app

# 爪专转 住驻专转 驻拽爪 驻转 住驻专转 注
WORKDIR $APP_HOME

# 转拽转 转转
COPY requirements.txt .
RUN pip install --upgrade pip
RUN pip install -r requirements.txt --no-cache-dir

# 砖 2: 砖 住驻 (Runtime image)
FROM python:3.11-slim

# 专转 砖转 住 
ENV PYTHONUNBUFFERED 1
ENV APP_HOME /app
ENV PORT 8080 # 专专转 , 转专住 注  Railway

# 爪专转 住驻专转 驻拽爪
WORKDIR $APP_HOME

# 注转拽转 转转 转拽转 砖 
COPY --from=builder /usr/local/lib/python3.11/site-packages /usr/local/lib/python3.11/site-packages

# ---  转拽: 转拽转 curl ---
# 注 专砖转 转 转拽转 curl ( 注专 start.sh)
RUN apt-get update && apt-get install -y curl \
    && rm -rf /var/lib/apt/lists/*
# --- 住祝 转拽 ---

# 注转拽转 拽 砖 住拽专驻 转
COPY . .

# 专转 专砖转 专爪 住拽专驻 start.sh - 拽专!
RUN chmod +x $APP_HOME/start.sh

# EXPOSE 注 转注
EXPOSE 8080

# 驻注转 start.sh 砖 转 Set Webhook  专抓 转 Gunicorn
CMD ["/bin/bash", "start.sh"]
